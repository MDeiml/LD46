<!DOCTYPE html>
<html>
    <head>
        <title>LD46</title>
         <!-- Disables mobile touch delay-->
        <meta name="viewport" content="width=device-width, user-scalable=no">
        <script type="module" src="main.js"></script>
        <script id="shader-vs" type="x-shader/x-vertex">
            attribute vec3 position;
            attribute vec2 texCoord;

            varying mediump vec2 vTexCoord;
            varying mediump vec2 worldPos;

            uniform mat4 M;
            uniform mat4 MVP;

            void main(void) {
                vTexCoord = texCoord;
                worldPos = (M * vec4(position, 1.0)).xy;
                gl_Position = MVP * vec4(position, 1.0);
            }
        </script>
        <script id="shader-fs" type="x-shader/x-fragment">
            precision mediump float;

            varying mediump vec2 vTexCoord;
            varying mediump vec2 worldPos;

            uniform sampler2D texture;
            uniform float fireIntensity;

            void main(void) {
                vec4 color = texture2D(texture, vTexCoord);
                if (color.a < 1.0) {
                    color.a = 0.0;
                }
                float t = clamp(fireIntensity/dot(worldPos, worldPos), 0.0, 1.0);
                float gray = color.r * 0.3 + color.g * 0.59 + color.b * 0.11;
                vec3 grayColor = gray * vec3(42.0/255.0, 51.0/255.0, 81.0/255.0);
                color.rgb = (1.0 - t) * grayColor + t * color.rgb * vec3(235.0/255.0, 178.0/255.0, 145.0/255.0);
                gl_FragColor = color;
            }
        </script>
        <style>
            * {
                margin: 0;
                padding: 0;
            }
            body, html { height: 100% }
            canvas {
                position: absolute;
                width: 100%;
                height: 100%;
            }
        </style>
    </head>

    <body>
        <canvas id="glCanvas" width="800" height="600"></canvas>
    </body>
</html>
